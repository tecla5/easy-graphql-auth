(function(t,u){'object'==typeof exports&&'object'==typeof module?module.exports=u():'function'==typeof define&&define.amd?define([],u):'object'==typeof exports?exports.easyGqlAuth=u():t.easyGqlAuth=u()})(this,function(){return function(s){function t(v){if(u[v])return u[v].exports;var w=u[v]={i:v,l:!1,exports:{}};return s[v].call(w.exports,w,w.exports,t),w.l=!0,w.exports}var u={};return t.m=s,t.c=u,t.i=function(v){return v},t.d=function(v,w,x){t.o(v,w)||Object.defineProperty(v,w,{configurable:!1,enumerable:!0,get:x})},t.n=function(v){var w=v&&v.__esModule?function(){return v['default']}:function(){return v};return t.d(w,'a',w),w},t.o=function(v,w){return Object.prototype.hasOwnProperty.call(v,w)},t.p='',t(t.s=3)}([function(s,t,u){'use strict';(function(v){var w,x,y,z='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&'function'==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?'symbol':typeof A};(function(A,B){'object'==z(t)&&'object'==z(v)?v.exports=B():(x=[],w=B,y='function'==typeof w?w.apply(t,x):w,!(y!==void 0&&(v.exports=y)))})(void 0,function(){return function(A){function B(D){if(C[D])return C[D].exports;var E=C[D]={i:D,l:!1,exports:{}};return A[D].call(E.exports,E,E.exports,B),E.l=!0,E.exports}var C={};return B.m=A,B.c=C,B.i=function(D){return D},B.d=function(D,E,F){B.o(D,E)||Object.defineProperty(D,E,{configurable:!1,enumerable:!0,get:F})},B.n=function(D){var E=D&&D.__esModule?function(){return D['default']}:function(){return D};return B.d(E,'a',E),E},B.o=function(D,E){return Object.prototype.hasOwnProperty.call(D,E)},B.p='',B(B.s=3)}([function(A,B){'use strict';Object.defineProperty(B,'__esModule',{value:!0}),B.default={auth0IdTokenKeyName:'auth0Token',gqlServerTokenStorageKey:'graphCoolToken'}},function(A,B){'use strict';function C(F,G){if(!(F instanceof G))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(B,'__esModule',{value:!0});var D=function(){function F(G,H){for(var I,J=0;J<H.length;J++)I=H[J],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(G,I.key,I)}return function(G,H,I){return H&&F(G.prototype,H),I&&F(G,I),G}}();B.createStore=function(F){var G=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new E(F,G)};var E=B.Store=function(){function F(G){var H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};C(this,F),this.keyNames=G.storage||G,this.storage=H.storage||H.keyStore||localStorage,this.auth0IdTokenKeyName=this.keyNames.auth0IdTokenKeyName,this.gqlServerTokenKeyName=this.keyNames.gqlServerTokenKeyName}return D(F,[{key:'removeItem',value:function(H){this.storage.removeItem(H)}},{key:'getItem',value:function(H){return this.storage.getItem(H)}},{key:'setItem',value:function(H,I){this.storage.setItem(H,I)}},{key:'validateKeyNames',value:function(){for(var H=this,I=arguments.length,J=Array(I),K=0;K<I;K++)J[K]=arguments[K];J.map(function(L){return H.validateKeyName(L)})}},{key:'validateKeyName',value:function(H){return'string'!=typeof this.keyNames[H]&&this.error('keyNames missing '+H),this}},{key:'error',value:function(H){console.error(H)}},{key:'resetAll',value:function(){this.removeItem(this.auth0TokenKeyName),this.removeItem(this.gqlServerTokenKeyName)}},{key:'getAll',value:function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{auth0Token:this.getItem(this.auth0IdTokenKeyName),gqlServerToken:this.getItem(this.gqlServerTokenKeyName)}}},{key:'store',value:function(H,I){if(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},0>this.keyNames.indexOf(H))throw Error('keyname mismatch for store: '+H);this.setItem(H,I)}}]),F}()},function(A,B,C){'use strict';function D(K,L){if(!(K instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(B,'__esModule',{value:!0}),B.Configurable=void 0;var E='function'==typeof Symbol&&'symbol'==z(Symbol.iterator)?function(K){return'undefined'==typeof K?'undefined':z(K)}:function(K){return K&&'function'==typeof Symbol&&K.constructor===Symbol&&K!==Symbol.prototype?'symbol':'undefined'==typeof K?'undefined':z(K)},F=function(){function K(L,M){for(var N,O=0;O<M.length;O++)N=M[O],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}return function(L,M,N){return M&&K(L.prototype,M),N&&K(L,N),L}}(),G=C(0),H=function(K){return K&&K.__esModule?K:{default:K}}(G),I=C(1),J=B.Configurable=function(){function K(){var L=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},M=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};D(this,K),this.validate(L);var N=L.keyNames,O=L.store,P=L.storage;this.config=L,this.io=M.io||console,this.logging=M.logging,this.observers={},this.config=L,this.storage=P,this.keyNames=N||P||H.default,this.store=O||this.defaultCreateStore(this.keyNames,M),this.tokens=this.store.getAll(),this.tokens=this.store?this.store.getAll():L.tokens}return F(K,[{key:'on',value:function(M,N){this.log('on',M,N);var O=this.observers[M]||[];return this.observers[M]=O.concat(N),this}},{key:'publish',value:function(M,N){this.log('publish',M,N);var O=this.observers[M]||[];return O?O.map(function(P){return P(N)}):this.log('no observers registered for',M),this}},{key:'handleError',value:function(M){throw this.error(M),M}},{key:'enableLog',value:function(){return this.logging=!0,this}},{key:'disableLog',value:function(){return this.logging=!1,this}},{key:'log',value:function(){if(this.logging){for(var M,N=arguments.length,O=Array(N),P=0;P<N;P++)O[P]=arguments[P];(M=this.io).log.apply(M,['Lock'].concat(O))}}},{key:'error',value:function(){if(this.logging){for(var M,N=arguments.length,O=Array(N),P=0;P<N;P++)O[P]=arguments[P];(M=this.io).error.apply(M,['Lock'].concat(O))}}},{key:'defaultCreateStore',value:function(M,N){return new I.Store(M,N)}},{key:'validate',value:function(M){if('object'!==('undefined'==typeof M?'undefined':E(M)))throw Error('config must be an object')}}]),K}()},function(A,B,C){'use strict';Object.defineProperty(B,'__esModule',{value:!0});var D=C(2);Object.defineProperty(B,'Configurable',{enumerable:!0,get:function(){return D.Configurable}});var E=C(0);Object.defineProperty(B,'keyNames',{enumerable:!0,get:function(){return E.keyNames}});var F=C(1);Object.defineProperty(B,'Store',{enumerable:!0,get:function(){return F.Store}}),Object.defineProperty(B,'createStore',{enumerable:!0,get:function(){return F.createStore}})}])})}).call(t,u(4)(s))},function(s,t,u){'use strict';function v(D){return function(){var E=D.apply(this,arguments);return new Promise(function(F,G){function H(I,J){try{var K=E[I](J),L=K.value}catch(M){return void G(M)}return K.done?void F(L):Promise.resolve(L).then(function(M){H('next',M)},function(M){H('throw',M)})}return H('next')})}}function w(D,E){if(!(D instanceof E))throw new TypeError('Cannot call a class as a function')}function x(D,E){if(!D)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return E&&('object'==typeof E||'function'==typeof E)?E:D}function y(D,E){if('function'!=typeof E&&null!==E)throw new TypeError('Super expression must either be null or a function, not '+typeof E);D.prototype=Object.create(E&&E.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(D,E):D.__proto__=E)}Object.defineProperty(t,'__esModule',{value:!0}),t.GraphQLAuth=void 0;var A=function(){function D(E,F){for(var H,G=0;G<F.length;G++)H=F[G],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(E,H.key,H)}return function(E,F,G){return F&&D(E.prototype,F),G&&D(E,G),E}}();t.createGraphQLAuth=function(D){new C(D)};var B=u(0),C=t.GraphQLAuth=function(D){function E(F){return w(this,E),x(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,F))}return y(E,D),A(E,[{key:'extractSignedInUserToken',value:function(G){return G.data.signinUser.token}},{key:'setGraphQLServerToken',value:function(G){return this.store.setItem(this.gqlServerTokenKeyName,G),this}},{key:'signin',value:function(){var G=v(regeneratorRuntime.mark(function H(I){var J,K,L,M,N;return regeneratorRuntime.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return J=I.auth0Token,K=I.profile,this.log('Signing into GraphQL server'),P.next=4,this.doCreateUser(I);case 4:return L=P.sent,P.next=7,this.doSigninUser(I);case 7:M=P.sent,N=this.extractSignedInUserToken(M),this.setGraphQLServerToken(N);case 10:case'end':return P.stop();}},H,this)}));return function(){return G.apply(this,arguments)}}()},{key:'handleQueryError',value:function(G){G.graphQLErrors&&G.graphQLErrors[0].code===errorCode.USER_ALREADY_EXISTS||this.handleError(G)}},{key:'buildUserData',value:function(G){var H=G.auth0Token,I=G.profile;return{variables:{authToken:H,name:I.name}}}},{key:'doCreateUser',value:function(){var G=v(regeneratorRuntime.mark(function H(I){var J,K,L;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(J=I.auth0Token,K=I.profile,N.prev=1,this.log('Create user',name),L=this.buildUserData(I),!this.queries.createUser){N.next=9;break}return N.next=7,this.queries.createUser(L);case 7:N.next=12;break;case 9:return this.log('missing createUser query, faking it'),N.next=12,this.fakeCreateUser(L);case 12:N.next=17;break;case 14:N.prev=14,N.t0=N['catch'](1),this.handleQueryError(N.t0);case 17:case'end':return N.stop();}},H,this,[[1,14]])}));return function(){return G.apply(this,arguments)}}()},{key:'fakeCreateUser',value:function(G){return G}},{key:'buildSigninUserData',value:function(G){var H=G.auth0Token,I=G.profile;return{variables:{authToken:H}}}},{key:'doSigninUser',value:function(){var G=v(regeneratorRuntime.mark(function H(I){var J,K,L;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(J=I.auth0Token,K=I.profile,this.log('signin user',I),this.queries.signinUser){N.next=4;break}return N.abrupt('return',this.fakeSigninUser(K));case 4:return L=this.buildSigninUserData(I),N.next=7,this.queries.signinUser(L);case 7:return N.abrupt('return',N.sent);case 8:case'end':return N.stop();}},H,this)}));return function(){return G.apply(this,arguments)}}()},{key:'fakeSigninUser',value:function(){return this.log('returning fake signedinUser'),{data:{signinUser:{token:'1234'}}}}},{key:'gqlServerTokenKeyName',get:function(){return this.store.gqlServerTokenKeyName}}]),E}(B.Configurable)},function(s,t,u){'use strict';function v(A,B){if(!(A instanceof B))throw new TypeError('Cannot call a class as a function')}function w(A,B){if(!A)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return B&&('object'==typeof B||'function'==typeof B)?B:A}function x(A,B){if('function'!=typeof B&&null!==B)throw new TypeError('Super expression must either be null or a function, not '+typeof B);A.prototype=Object.create(B&&B.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(A,B):A.__proto__=B)}Object.defineProperty(t,'__esModule',{value:!0}),t.GraphQLConnection=void 0;var y=u(0),z=t.GraphQLConnection=function(A){function B(){var C=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,B);var D=w(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,C));return D.connection=C.gqlServer.connection,D}return x(B,A),B}(y.Configurable)},function(s,t,u){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var v=u(1);Object.defineProperty(t,'GraphQLAuth',{enumerable:!0,get:function(){return v.GraphQLAuth}});var w=u(2);Object.defineProperty(t,'GraphQLConnection',{enumerable:!0,get:function(){return w.GraphQLConnection}})},function(s){s.exports=function(u){return u.webpackPolyfill||(u.deprecate=function(){},u.paths=[],!u.children&&(u.children=[]),Object.defineProperty(u,'loaded',{enumerable:!0,get:function(){return u.l}}),Object.defineProperty(u,'id',{enumerable:!0,get:function(){return u.i}}),u.webpackPolyfill=1),u}}])});
//# sourceMappingURL=bundle.prod.js.map