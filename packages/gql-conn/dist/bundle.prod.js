(function(y,z){'object'==typeof exports&&'object'==typeof module?module.exports=z():'function'==typeof define&&define.amd?define([],z):'object'==typeof exports?exports.easyGqlAuth=z():y.easyGqlAuth=z()})(this,function(){return function(x){function y(A){if(z[A])return z[A].exports;var B=z[A]={i:A,l:!1,exports:{}};return x[A].call(B.exports,B,B.exports,y),B.l=!0,B.exports}var z={};return y.m=x,y.c=z,y.i=function(A){return A},y.d=function(A,B,C){y.o(A,B)||Object.defineProperty(A,B,{configurable:!1,enumerable:!0,get:C})},y.n=function(A){var B=A&&A.__esModule?function(){return A['default']}:function(){return A};return y.d(B,'a',B),B},y.o=function(A,B){return Object.prototype.hasOwnProperty.call(A,B)},y.p='',y(y.s=3)}([function(x,y,z){'use strict';(function(A){var B,C,D,E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(F){return typeof F}:function(F){return F&&'function'==typeof Symbol&&F.constructor===Symbol&&F!==Symbol.prototype?'symbol':typeof F};(function(F,G){'object'==E(y)&&'object'==E(A)?A.exports=G():(C=[],B=G,D='function'==typeof B?B.apply(y,C):B,!(D!==void 0&&(A.exports=D)))})(void 0,function(){return function(F){function G(I){if(H[I])return H[I].exports;var J=H[I]={i:I,l:!1,exports:{}};return F[I].call(J.exports,J,J.exports,G),J.l=!0,J.exports}var H={};return G.m=F,G.c=H,G.i=function(I){return I},G.d=function(I,J,K){G.o(I,J)||Object.defineProperty(I,J,{configurable:!1,enumerable:!0,get:K})},G.n=function(I){var J=I&&I.__esModule?function(){return I['default']}:function(){return I};return G.d(J,'a',J),J},G.o=function(I,J){return Object.prototype.hasOwnProperty.call(I,J)},G.p='',G(G.s=4)}([function(F,G){'use strict';Object.defineProperty(G,'__esModule',{value:!0}),G.default={auth0IdTokenKeyName:'auth0Token',gqlServerTokenStorageKey:'graphCoolToken'}},function(F,G,H){'use strict';function I(O,P){if(!(O instanceof P))throw new TypeError('Cannot call a class as a function')}function J(O,P){if(!O)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return P&&('object'==('undefined'==typeof P?'undefined':E(P))||'function'==typeof P)?P:O}function K(O,P){if('function'!=typeof P&&null!==P)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof P?'undefined':E(P)));O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}Object.defineProperty(G,'__esModule',{value:!0}),G.Store=void 0;var L=function(){function O(P,Q){for(var R,S=0;S<Q.length;S++)R=Q[S],R.enumerable=R.enumerable||!1,R.configurable=!0,'value'in R&&(R.writable=!0),Object.defineProperty(P,R.key,R)}return function(P,Q,R){return Q&&O(P.prototype,Q),R&&O(P,R),P}}();G.createStore=function(O){var P=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new N(O,P)};var M=H(2),N=G.Store=function(O){function P(Q){var R=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};I(this,P);var S=J(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,'Store',R));return S.log('create',{keyNames:Q,opts:R}),S.keyNames=Q.storage||Q,S.storage=R.storage||R.keyStore||window.localStorage,S.auth0IdTokenKeyName=S.keyNames.auth0IdTokenKeyName,S.gqlServerTokenKeyName=S.keyNames.gqlServerTokenKeyName,S}return K(P,O),L(P,[{key:'removeItem',value:function(R){this.storage.removeItem(R)}},{key:'getItem',value:function(R){return this.storage.getItem(R)}},{key:'setItem',value:function(R,S){this.storage.setItem(R,S)}},{key:'validateKeyNames',value:function(){for(var R=this,S=arguments.length,T=Array(S),U=0;U<S;U++)T[U]=arguments[U];T.map(function(V){return R.validateKeyName(V)})}},{key:'validateKeyName',value:function(R){return'string'!=typeof this.keyNames[R]&&this.error('keyNames missing '+R),this}},{key:'error',value:function(R){console.error(R)}},{key:'resetAll',value:function(){this.removeItem(this.auth0TokenKeyName),this.removeItem(this.gqlServerTokenKeyName)}},{key:'getAll',value:function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{auth0Token:this.getItem(this.auth0IdTokenKeyName),gqlServerToken:this.getItem(this.gqlServerTokenKeyName)}}},{key:'store',value:function(R,S){if(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},0>this.keyNames.indexOf(R))throw Error('keyname mismatch for store: '+R);this.setItem(R,S)}}]),P}(M.Loggable)},function(F,G){'use strict';function H(K,L){if(!(K instanceof L))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(G,'__esModule',{value:!0});var I=function(){function K(L,M){for(var N,O=0;O<M.length;O++)N=M[O],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}return function(L,M,N){return M&&K(L.prototype,M),N&&K(L,N),L}}(),J=G.Loggable=function(){function K(L){var M=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};H(this,K),this.io=M.io||console,this.logging=M.logging,this.name=L||M.name}return I(K,[{key:'enableLog',value:function(){return this.logging=!0,this}},{key:'disableLog',value:function(){return this.logging=!1,this}},{key:'log',value:function(){if(this.logging){for(var M,N=arguments.length,O=Array(N),P=0;P<N;P++)O[P]=arguments[P];(M=this.io).log.apply(M,[this.name].concat(O))}}},{key:'error',value:function(){if(this.logging){for(var M,N=arguments.length,O=Array(N),P=0;P<N;P++)O[P]=arguments[P];(M=this.io).error.apply(M,[this.name].concat(O))}}}]),K}()},function(F,G,H){'use strict';function I(S,T){if(!(S instanceof T))throw new TypeError('Cannot call a class as a function')}function J(S,T){if(!S)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return T&&('object'==('undefined'==typeof T?'undefined':E(T))||'function'==typeof T)?T:S}function K(S,T){if('function'!=typeof T&&null!==T)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof T?'undefined':E(T)));S.prototype=Object.create(T&&T.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),T&&(Object.setPrototypeOf?Object.setPrototypeOf(S,T):S.__proto__=T)}Object.defineProperty(G,'__esModule',{value:!0}),G.Configurable=void 0;var L='function'==typeof Symbol&&'symbol'==E(Symbol.iterator)?function(S){return'undefined'==typeof S?'undefined':E(S)}:function(S){return S&&'function'==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?'symbol':'undefined'==typeof S?'undefined':E(S)},M=function(){function S(T,U){for(var V,W=0;W<U.length;W++)V=U[W],V.enumerable=V.enumerable||!1,V.configurable=!0,'value'in V&&(V.writable=!0),Object.defineProperty(T,V.key,V)}return function(T,U,V){return U&&S(T.prototype,U),V&&S(T,V),T}}(),N=H(0),O=function(S){return S&&S.__esModule?S:{default:S}}(N),P=H(2),Q=H(1),R=G.Configurable=function(S){function T(){var U=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},V=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};I(this,T);var W=J(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,'Configurable',V));W.validate(U);var X=U.keyNames,Y=U.store,Z=U.storage;return W.config=U,W.observers={},W.config=U,W.storage=Z,W.keyNames=X||Z||O.default,W.store=Y||W.defaultCreateStore(W.keyNames,V),W.tokens=W.store.getAll(),W.tokens=W.store?W.store.getAll():U.tokens,W}return K(T,S),M(T,[{key:'configError',value:function(V){throw this.error(V),Error(V)}},{key:'on',value:function(V,W){this.log('on',V,W);var X=this.observers[V]||[];return this.observers[V]=X.concat(W),this}},{key:'publish',value:function(V,W){this.log('publish',V,W);var X=this.observers[V]||[];return X?X.map(function(Y){return Y(W)}):this.log('no observers registered for',V),this}},{key:'handleError',value:function(V){throw this.error(V),V}},{key:'defaultCreateStore',value:function(V,W){return new Q.Store(V,W)}},{key:'validate',value:function(V){if('object'!==('undefined'==typeof V?'undefined':L(V)))throw Error('config must be an object')}}]),T}(P.Loggable)},function(F,G,H){'use strict';Object.defineProperty(G,'__esModule',{value:!0});var I=H(3);Object.defineProperty(G,'Configurable',{enumerable:!0,get:function(){return I.Configurable}});var J=H(0);Object.defineProperty(G,'keyNames',{enumerable:!0,get:function(){return J.keyNames}});var K=H(1);Object.defineProperty(G,'Store',{enumerable:!0,get:function(){return K.Store}}),Object.defineProperty(G,'createStore',{enumerable:!0,get:function(){return K.createStore}})}])})}).call(y,z(4)(x))},function(x,y,z){'use strict';function A(I){return function(){var J=I.apply(this,arguments);return new Promise(function(K,L){function M(N,O){try{var P=J[N](O),Q=P.value}catch(R){return void L(R)}return P.done?void K(Q):Promise.resolve(Q).then(function(R){M('next',R)},function(R){M('throw',R)})}return M('next')})}}function B(I,J){if(!(I instanceof J))throw new TypeError('Cannot call a class as a function')}function C(I,J){if(!I)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return J&&('object'==typeof J||'function'==typeof J)?J:I}function D(I,J){if('function'!=typeof J&&null!==J)throw new TypeError('Super expression must either be null or a function, not '+typeof J);I.prototype=Object.create(J&&J.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),J&&(Object.setPrototypeOf?Object.setPrototypeOf(I,J):I.__proto__=J)}Object.defineProperty(y,'__esModule',{value:!0}),y.GraphQLAuth=void 0;var F=function(){function I(J,K){for(var M,L=0;L<K.length;L++)M=K[L],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(J,M.key,M)}return function(J,K,L){return K&&I(J.prototype,K),L&&I(J,L),J}}();y.createGraphQLAuth=function(I){return new H(I)};var G=z(0),H=y.GraphQLAuth=function(I){function J(K){return B(this,J),C(this,(J.__proto__||Object.getPrototypeOf(J)).call(this,K))}return D(J,I),F(J,[{key:'extractSignedInUserToken',value:function(L){return L.data.signinUser.token}},{key:'setGraphQLServerToken',value:function(L){return this.store.setItem(this.gqlServerTokenKeyName,L),this}},{key:'signin',value:function(){var L=A(regeneratorRuntime.mark(function M(N){var O,P,Q,R,S;return regeneratorRuntime.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return O=N.auth0Token,P=N.profile,this.log('Signing into GraphQL server'),U.next=4,this.doCreateUser(N);case 4:return Q=U.sent,U.next=7,this.doSigninUser(N);case 7:R=U.sent,S=this.extractSignedInUserToken(R),this.setGraphQLServerToken(S);case 10:case'end':return U.stop();}},M,this)}));return function(){return L.apply(this,arguments)}}()},{key:'handleQueryError',value:function(L){L.graphQLErrors&&L.graphQLErrors[0].code===errorCode.USER_ALREADY_EXISTS||this.handleError(L)}},{key:'buildUserData',value:function(L){var M=L.auth0Token,N=L.profile;return{variables:{authToken:M,name:N.name}}}},{key:'doCreateUser',value:function(){var L=A(regeneratorRuntime.mark(function M(N){var O,P,Q;return regeneratorRuntime.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(O=N.auth0Token,P=N.profile,S.prev=1,this.log('Create user',name),Q=this.buildUserData(N),!this.queries.createUser){S.next=9;break}return S.next=7,this.queries.createUser(Q);case 7:S.next=12;break;case 9:return this.log('missing createUser query, faking it'),S.next=12,this.fakeCreateUser(Q);case 12:S.next=17;break;case 14:S.prev=14,S.t0=S['catch'](1),this.handleQueryError(S.t0);case 17:case'end':return S.stop();}},M,this,[[1,14]])}));return function(){return L.apply(this,arguments)}}()},{key:'fakeCreateUser',value:function(L){return L}},{key:'buildSigninUserData',value:function(L){var M=L.auth0Token,N=L.profile;return{variables:{authToken:M}}}},{key:'doSigninUser',value:function(){var L=A(regeneratorRuntime.mark(function M(N){var O,P,Q;return regeneratorRuntime.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(O=N.auth0Token,P=N.profile,this.log('signin user',N),this.queries.signinUser){S.next=4;break}return S.abrupt('return',this.fakeSigninUser(P));case 4:return Q=this.buildSigninUserData(N),S.next=7,this.queries.signinUser(Q);case 7:return S.abrupt('return',S.sent);case 8:case'end':return S.stop();}},M,this)}));return function(){return L.apply(this,arguments)}}()},{key:'fakeSigninUser',value:function(){return this.log('returning fake signedinUser'),{data:{signinUser:{token:'1234'}}}}},{key:'gqlServerTokenKeyName',get:function(){return this.store.gqlServerTokenKeyName}}]),J}(G.Configurable)},function(x,y,z){'use strict';function A(F,G){if(!(F instanceof G))throw new TypeError('Cannot call a class as a function')}function B(F,G){if(!F)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return G&&('object'==typeof G||'function'==typeof G)?G:F}function C(F,G){if('function'!=typeof G&&null!==G)throw new TypeError('Super expression must either be null or a function, not '+typeof G);F.prototype=Object.create(G&&G.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),G&&(Object.setPrototypeOf?Object.setPrototypeOf(F,G):F.__proto__=G)}Object.defineProperty(y,'__esModule',{value:!0}),y.GraphQLConnection=void 0;var D=z(0),E=y.GraphQLConnection=function(F){function G(){var H=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};A(this,G);var I=B(this,(G.__proto__||Object.getPrototypeOf(G)).call(this,H)),J=H.gqlServer;return I.gqlServer=J,I.connection=J.connection,I.connection.endpoint=J.endpoint||I.connection.uri,I}return C(G,F),G}(D.Configurable)},function(x,y,z){'use strict';Object.defineProperty(y,'__esModule',{value:!0});var A=z(1);Object.defineProperty(y,'GraphQLAuth',{enumerable:!0,get:function(){return A.GraphQLAuth}});var B=z(2);Object.defineProperty(y,'GraphQLConnection',{enumerable:!0,get:function(){return B.GraphQLConnection}})},function(x){x.exports=function(z){return z.webpackPolyfill||(z.deprecate=function(){},z.paths=[],!z.children&&(z.children=[]),Object.defineProperty(z,'loaded',{enumerable:!0,get:function(){return z.l}}),Object.defineProperty(z,'id',{enumerable:!0,get:function(){return z.i}}),z.webpackPolyfill=1),z}}])});
//# sourceMappingURL=bundle.prod.js.map