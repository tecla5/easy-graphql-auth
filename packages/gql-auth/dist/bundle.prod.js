(function(b,c){'object'==typeof exports&&'object'==typeof module?module.exports=c():'function'==typeof define&&define.amd?define([],c):'object'==typeof exports?exports.easyGqlAuth=c():b.easyGqlAuth=c()})(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(d){return d},b.d=function(d,e,f){b.o(d,e)||Object.defineProperty(d,e,{configurable:!1,enumerable:!0,get:f})},b.n=function(d){var e=d&&d.__esModule?function(){return d['default']}:function(){return d};return b.d(e,'a',e),e},b.o=function(d,e){return Object.prototype.hasOwnProperty.call(d,e)},b.p='',b(b.s=1)}([function(a,b,c){'use strict';function d(m){return function(){var n=m.apply(this,arguments);return new Promise(function(o,p){function q(r,s){try{var t=n[r](s),u=t.value}catch(v){return void p(v)}return t.done?void o(u):Promise.resolve(u).then(function(v){q('next',v)},function(v){q('throw',v)})}return q('next')})}}function e(m,n){if(!(m instanceof n))throw new TypeError('Cannot call a class as a function')}function f(m,n){if(!m)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return n&&('object'==typeof n||'function'==typeof n)?n:m}function g(m,n){if('function'!=typeof n&&null!==n)throw new TypeError('Super expression must either be null or a function, not '+typeof n);m.prototype=Object.create(n&&n.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(m,n):m.__proto__=n)}Object.defineProperty(b,'__esModule',{value:!0}),b.GraphQLAuth=void 0;var j=function(){function m(n,o){for(var q,p=0;p<o.length;p++)q=o[p],q.enumerable=q.enumerable||!1,q.configurable=!0,'value'in q&&(q.writable=!0),Object.defineProperty(n,q.key,q)}return function(n,o,p){return o&&m(n.prototype,o),p&&m(n,p),n}}();b.createGraphQLAuth=function(m){return new l(m)};var k=c(2),l=b.GraphQLAuth=function(m){function n(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e(this,n);var q=f(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o,p));return q.connection=q.connection||o.connection,p.createConnection&&(q.connection=p.createConnection(o,p)),q.validateConfig(),q}return g(n,m),j(n,[{key:'validateConfig',value:function(){this.connection||this.configError('missing GraphQL connection in configuration')}},{key:'extractSignedInUserToken',value:function(p){return p.data.signinUser.token}},{key:'setGraphQLServerToken',value:function(p){return this.store.setItem(this.gqlServerTokenKeyName,p),this.publish('storedGraphQLServerToken',{signinToken:p}),this}},{key:'signin',value:function(){var p=d(regeneratorRuntime.mark(function q(r){var s,t,u,v,w;return regeneratorRuntime.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return s=r.authToken,t=r.profile,this.log('Signing into GraphQL server'),W.next=4,this.doCreateUser(r);case 4:return u=W.sent,W.next=7,this.doSigninUser(r);case 7:v=W.sent,w=this.extractSignedInUserToken(v),this.handleReceivedGraphQLServerToken(w);case 10:case'end':return W.stop();}},q,this)}));return function(){return p.apply(this,arguments)}}()},{key:'handleReceivedGraphQLServerToken',value:function(p){this.publish('receivedGraphQLServerToken',{signinToken:p}),this.setGraphQLServerToken(p),this.setJwtToken(p)}},{key:'setJwtToken',value:function(p){this.connection?(this.connection.setJwtToken(p,this.opts),this.publish('setJwtToken',{signinToken:p})):this.error('missing connection for setting JWT token')}},{key:'handleQueryError',value:function(p){p.graphQLErrors&&p.graphQLErrors[0].code===errorCode.USER_ALREADY_EXISTS||this.handleError(p)}},{key:'buildUserData',value:function(p){var q=p.authToken,r=p.profile;return{variables:{authToken:q,name:r.name}}}},{key:'doCreateUser',value:function(){var p=d(regeneratorRuntime.mark(function q(r){var s,t,u,v;return regeneratorRuntime.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(s=r.authToken,t=r.profile,V.prev=1,this.log('Create user',name),u=this.buildUserData(r),!this.queries.createUser){V.next=12;break}return V.next=7,this.doQuery({query:this.queries.createUser(u)});case 7:return v=V.sent,publish('createdUserOK',{authToken:s,userData:u,profile:t,result:v}),V.abrupt('return',v);case 12:return this.log('missing createUser query, faking it'),V.next=15,this.fakeCreateUser(u);case 15:V.next=21;break;case 17:V.prev=17,V.t0=V['catch'](1),publish('createUserFailure',{authToken:s,userData:userData,profile:t,result:result,error:V.t0}),this.handleQueryError(err);case 21:case'end':return V.stop();}},q,this,[[1,17]])}));return function(){return p.apply(this,arguments)}}()},{key:'doQuery',value:function(){var p=d(regeneratorRuntime.mark(function q(r){var s=r.query;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.connection.doQuery(s,opts);case 2:return u.abrupt('return',u.sent);case 3:case'end':return u.stop();}},q,this)}));return function(){return p.apply(this,arguments)}}()},{key:'fakeCreateUser',value:function(p){return p}},{key:'buildSigninUserData',value:function(p){var q=p.authToken,r=p.profile;return{variables:{authToken:q}}}},{key:'doSigninUser',value:function(){var p=d(regeneratorRuntime.mark(function q(r){var s,t,u,v;return regeneratorRuntime.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(s=r.authToken,t=r.profile,this.log('signin user',r),this.queries.signinUser){V.next=4;break}return V.abrupt('return',this.fakeSigninUser(t));case 4:return u=this.buildSigninUserData(r),V.prev=5,V.next=8,this.doQuery({query:this.queries.signinUser(u)});case 8:return v=V.sent,this.publish('signedInOK',{authToken:s,profile:t,userData:u,result:v}),V.abrupt('return',v);case 13:V.prev=13,V.t0=V['catch'](5),this.publish('signedInFailure',{authToken:s,profile:t,userData:u,error:V.t0}),this.handleQueryError(V.t0);case 17:case'end':return V.stop();}},q,this,[[5,13]])}));return function(){return p.apply(this,arguments)}}()},{key:'fakeSigninUser',value:function(){return this.log('returning fake signedinUser'),{data:{signinUser:{token:'1234'}}}}},{key:'gqlServerTokenKeyName',get:function(){return this.store.gqlServerTokenKeyName}}]),n}(k.GraphQLConnection)},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var d=c(0);Object.defineProperty(b,'GraphQLAuth',{enumerable:!0,get:function(){return d.GraphQLAuth}})},function(a,b,c){'use strict';(function(d){var e,f,g,h='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(j){return typeof j}:function(j){return j&&'function'==typeof Symbol&&j.constructor===Symbol&&j!==Symbol.prototype?'symbol':typeof j};(function(j,k){'object'==h(b)&&'object'==h(d)?d.exports=k():(f=[],e=k,g='function'==typeof e?e.apply(b,f):e,!(g!==void 0&&(d.exports=g)))})(void 0,function(){return function(j){function k(m){if(l[m])return l[m].exports;var n=l[m]={i:m,l:!1,exports:{}};return j[m].call(n.exports,n,n.exports,k),n.l=!0,n.exports}var l={};return k.m=j,k.c=l,k.i=function(m){return m},k.d=function(m,n,o){k.o(m,n)||Object.defineProperty(m,n,{configurable:!1,enumerable:!0,get:o})},k.n=function(m){var n=m&&m.__esModule?function(){return m['default']}:function(){return m};return k.d(n,'a',n),n},k.o=function(m,n){return Object.prototype.hasOwnProperty.call(m,n)},k.p='',k(k.s=2)}([function(j,k,l){'use strict';function m(t,u){if(!(t instanceof u))throw new TypeError('Cannot call a class as a function')}function n(t,u){if(!t)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return u&&('object'==('undefined'==typeof u?'undefined':h(u))||'function'==typeof u)?u:t}function o(t,u){if('function'!=typeof u&&null!==u)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof u?'undefined':h(u)));t.prototype=Object.create(u&&u.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(t,u):t.__proto__=u)}Object.defineProperty(k,'__esModule',{value:!0}),k.GraphQLConnection=void 0;var p='function'==typeof Symbol&&'symbol'==h(Symbol.iterator)?function(t){return'undefined'==typeof t?'undefined':h(t)}:function(t){return t&&'function'==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?'symbol':'undefined'==typeof t?'undefined':h(t)},q=function(){function t(u,v){for(var w,V=0;V<v.length;V++)w=v[V],w.enumerable=w.enumerable||!1,w.configurable=!0,'value'in w&&(w.writable=!0),Object.defineProperty(u,w.key,w)}return function(u,v,w){return v&&t(u.prototype,v),w&&t(u,w),u}}(),r=l(1),s=k.GraphQLConnection=function(t){function u(){var v=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},w=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};m(this,u);var V=n(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,v,w)),W=v.gqlServer;return W.endpoint=W.endpoint||W.connection.uri,V.config.gqlServer=W,V.validateConnection(),V}return o(u,t),q(u,[{key:'validateConnection',value:function(){'object'!==p(this.store)&&this.configError('missing store for holding signinToken from GraphQL server'),'object'!==p(this.keyNames)&&this.configError('missing keyNames object, used to indicate store token keys')}},{key:'setJwtToken',value:function(w){1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},this.log('setJwtToken not yet implemented on GraphQL server Connection :(',{signinToken:w})}},{key:'defaultHeaders',get:function(){return null}},{key:'authTokenKeyName',get:function(){return this.keyNames.gqlServerTokenKeyName}},{key:'authToken',get:function(){return this.store.getItem(this.authTokenKeyName)||null}}]),u}(r.Configurable)},function(j){(function(l,m){j.exports=m()})(this,function(){return function(l){function m(o){if(n[o])return n[o].exports;var p=n[o]={i:o,l:!1,exports:{}};return l[o].call(p.exports,p,p.exports,m),p.l=!0,p.exports}var n={};return m.m=l,m.c=n,m.i=function(o){return o},m.d=function(o,p,q){m.o(o,p)||Object.defineProperty(o,p,{configurable:!1,enumerable:!0,get:q})},m.n=function(o){var p=o&&o.__esModule?function(){return o['default']}:function(){return o};return m.d(p,'a',p),p},m.o=function(o,p){return Object.prototype.hasOwnProperty.call(o,p)},m.p='',m(m.s=4)}([function(l,m){'use strict';Object.defineProperty(m,'__esModule',{value:!0}),m.default={auth0IdTokenKeyName:'auth0Token',gqlServerTokenStorageKey:'graphCoolToken'}},function(l,m,n){'use strict';function o(u,v){if(!(u instanceof v))throw new TypeError('Cannot call a class as a function')}function p(u,v){if(!u)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return v&&('object'==('undefined'==typeof v?'undefined':h(v))||'function'==typeof v)?v:u}function q(u,v){if('function'!=typeof v&&null!==v)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof v?'undefined':h(v)));u.prototype=Object.create(v&&v.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(u,v):u.__proto__=v)}Object.defineProperty(m,'__esModule',{value:!0}),m.Store=void 0;var r=function(){function u(v,w){for(var V,W=0;W<w.length;W++)V=w[W],V.enumerable=V.enumerable||!1,V.configurable=!0,'value'in V&&(V.writable=!0),Object.defineProperty(v,V.key,V)}return function(v,w,V){return w&&u(v.prototype,w),V&&u(v,V),v}}();m.createStore=function(u){var v=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new t(u,v)};var s=n(2),t=m.Store=function(u){function v(w){var V=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,v);var W=p(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,'Store',V));return W.log('create',{keyNames:w,opts:V}),W.keyNames=w.storage||w,W.storage=V.storage||V.keyStore||window.localStorage,W.auth0IdTokenKeyName=W.keyNames.auth0IdTokenKeyName,W.gqlServerTokenKeyName=W.keyNames.gqlServerTokenKeyName,W}return q(v,u),r(v,[{key:'removeItem',value:function(V){this.storage.removeItem(V)}},{key:'getItem',value:function(V){return this.storage.getItem(V)}},{key:'setItem',value:function(V,W){this.storage.setItem(V,W)}},{key:'validateKeyNames',value:function(){for(var V=this,W=arguments.length,X=Array(W),Y=0;Y<W;Y++)X[Y]=arguments[Y];X.map(function(Z){return V.validateKeyName(Z)})}},{key:'validateKeyName',value:function(V){return'string'!=typeof this.keyNames[V]&&this.error('keyNames missing '+V),this}},{key:'error',value:function(V){console.error(V)}},{key:'resetAll',value:function(){this.removeItem(this.auth0TokenKeyName),this.removeItem(this.gqlServerTokenKeyName)}},{key:'getAll',value:function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{auth0Token:this.getItem(this.auth0IdTokenKeyName),gqlServerToken:this.getItem(this.gqlServerTokenKeyName)}}},{key:'store',value:function(V,W){if(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},0>this.keyNames.indexOf(V))throw Error('keyname mismatch for store: '+V);this.setItem(V,W)}}]),v}(s.Loggable)},function(l,m){'use strict';function n(q,r){if(!(q instanceof r))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(m,'__esModule',{value:!0});var o=function(){function q(r,s){for(var t,u=0;u<s.length;u++)t=s[u],t.enumerable=t.enumerable||!1,t.configurable=!0,'value'in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}return function(r,s,t){return s&&q(r.prototype,s),t&&q(r,t),r}}(),p=m.Loggable=function(){function q(r){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,q),this.io=s.io||console,this.logging=s.logging,this.name=r||s.name}return o(q,[{key:'enableLog',value:function(){return this.logging=!0,this}},{key:'disableLog',value:function(){return this.logging=!1,this}},{key:'log',value:function(){if(this.logging){for(var s,t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];(s=this.io).log.apply(s,[this.name].concat(u))}}},{key:'error',value:function(){if(this.logging){for(var s,t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];(s=this.io).error.apply(s,[this.name].concat(u))}}}]),q}()},function(l,m,n){'use strict';function o(W,X){if(!(W instanceof X))throw new TypeError('Cannot call a class as a function')}function p(W,X){if(!W)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return X&&('object'==('undefined'==typeof X?'undefined':h(X))||'function'==typeof X)?X:W}function q(W,X){if('function'!=typeof X&&null!==X)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof X?'undefined':h(X)));W.prototype=Object.create(X&&X.prototype,{constructor:{value:W,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(W,X):W.__proto__=X)}Object.defineProperty(m,'__esModule',{value:!0}),m.Configurable=void 0;var r='function'==typeof Symbol&&'symbol'==h(Symbol.iterator)?function(W){return'undefined'==typeof W?'undefined':h(W)}:function(W){return W&&'function'==typeof Symbol&&W.constructor===Symbol&&W!==Symbol.prototype?'symbol':'undefined'==typeof W?'undefined':h(W)},s=function(){function W(X,Y){for(var Z,$=0;$<Y.length;$++)Z=Y[$],Z.enumerable=Z.enumerable||!1,Z.configurable=!0,'value'in Z&&(Z.writable=!0),Object.defineProperty(X,Z.key,Z)}return function(X,Y,Z){return Y&&W(X.prototype,Y),Z&&W(X,Z),X}}(),t=n(0),u=function(W){return W&&W.__esModule?W:{default:W}}(t),v=n(2),w=n(1),V=m.Configurable=function(W){function X(){var Y=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,X);var $=p(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,'Configurable',Z));$.validate(Y);var _=Y.keyNames,aa=Y.store,ba=Y.storage;return $.config=Y,$.observers={},$.config=Y,$.storage=ba,$.keyNames=_||ba||u.default,$.store=aa||$.defaultCreateStore($.keyNames,Z),$.tokens=$.store.getAll(),$.tokens=$.store?$.store.getAll():Y.tokens,$}return q(X,W),s(X,[{key:'configError',value:function(Z){throw this.error(Z),Error(Z)}},{key:'on',value:function(Z,$){this.log('on',Z,$);var _=this.observers[Z]||[];return this.observers[Z]=_.concat($),this}},{key:'publish',value:function(Z,$){this.log('publish',Z,$);var _=this.observers[Z]||[];return _?_.map(function(aa){return aa($)}):this.log('no observers registered for',Z),this}},{key:'handleError',value:function(Z){throw this.error(Z),Z}},{key:'defaultCreateStore',value:function(Z,$){return new w.Store(Z,$)}},{key:'validate',value:function(Z){if('object'!==('undefined'==typeof Z?'undefined':r(Z)))throw Error('config must be an object')}}]),X}(v.Loggable)},function(l,m,n){'use strict';Object.defineProperty(m,'__esModule',{value:!0});var o=n(3);Object.defineProperty(m,'Configurable',{enumerable:!0,get:function(){return o.Configurable}});var p=n(0);Object.defineProperty(m,'keyNames',{enumerable:!0,get:function(){return p.keyNames}});var q=n(1);Object.defineProperty(m,'Store',{enumerable:!0,get:function(){return q.Store}}),Object.defineProperty(m,'createStore',{enumerable:!0,get:function(){return q.createStore}})}])})},function(j,k,l){'use strict';Object.defineProperty(k,'__esModule',{value:!0});var m=l(0);Object.defineProperty(k,'GraphQLConnection',{enumerable:!0,get:function(){return m.GraphQLConnection}})}])})}).call(b,c(3)(a))},function(a){a.exports=function(c){return c.webpackPolyfill||(c.deprecate=function(){},c.paths=[],!c.children&&(c.children=[]),Object.defineProperty(c,'loaded',{enumerable:!0,get:function(){return c.l}}),Object.defineProperty(c,'id',{enumerable:!0,get:function(){return c.i}}),c.webpackPolyfill=1),c}}])});
//# sourceMappingURL=bundle.prod.js.map