(function(b,c){'object'==typeof exports&&'object'==typeof module?module.exports=c():'function'==typeof define&&define.amd?define([],c):'object'==typeof exports?exports.gqlAuth=c():b.gqlAuth=c()})(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var f=c[d]={i:d,l:!1,exports:{}};return a[d].call(f.exports,f,f.exports,b),f.l=!0,f.exports}var c={};return b.m=a,b.c=c,b.i=function(d){return d},b.d=function(d,f,g){b.o(d,f)||Object.defineProperty(d,f,{configurable:!1,enumerable:!0,get:g})},b.n=function(d){var f=d&&d.__esModule?function(){return d['default']}:function(){return d};return b.d(f,'a',f),f},b.o=function(d,f){return Object.prototype.hasOwnProperty.call(d,f)},b.p='',b(b.s=4)}([function(a,b){'use strict';Object.defineProperty(b,'__esModule',{value:!0}),b.default={authTokenKeyName:'auth0Token',gqlServerTokenKeyName:'gqlServerAuthToken',serverTokenKeyName:'serverAuthToken'},a.exports=b['default']},function(a,b,c){'use strict';function d(n,o){if(!(n instanceof o))throw new TypeError('Cannot call a class as a function')}function f(n,o){if(!n)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return o&&('object'==typeof o||'function'==typeof o)?o:n}function g(n,o){if('function'!=typeof o&&null!==o)throw new TypeError('Super expression must either be null or a function, not '+typeof o);n.prototype=Object.create(o&&o.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(n,o):n.__proto__=o)}Object.defineProperty(b,'__esModule',{value:!0}),b.Notifiable=void 0;var h='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&'function'==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?'symbol':typeof n},j=function(){function n(o,p){for(var r,q=0;q<p.length;q++)r=p[q],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}return function(o,p,q){return p&&n(o.prototype,p),q&&n(o,q),o}}(),k=function n(o,p,q){null===o&&(o=Function.prototype);var r=Object.getOwnPropertyDescriptor(o,p);if(r===void 0){var s=Object.getPrototypeOf(o);return null===s?void 0:n(s,p,q)}if('value'in r)return r.value;var t=r.get;return void 0===t?void 0:t.call(q)},l=c(10),m=b.Notifiable=function(n){function o(p,q){d(this,o);var r=f(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,p,q));return r.notifyLog=q.notifyLog,r.topic=q.topic||r.defaultTopic,r.notifyError=r.notifyFailure,r.observers={},r}return g(o,n),j(o,[{key:'log',value:function(q,r){!1===this.notifyLog||k(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),'log',this).call(this,q,r)}},{key:'notify',value:function(q,r){var s=this._criteria(q,r);this.publish(s,r)}},{key:'_criteria',value:function(q,r){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Object.assign({},{topic:this.topic,event:q,data:r},s)}},{key:'notifySuccess',value:function(q,r){var s=this._criteria(q,r,{status:'success'});this.publish(s,r)}},{key:'notifyFailure',value:function(q,r){var s=this._criteria(q,r,{status:'failure'});this.publish(s,r)}},{key:'onCriteria',value:function(q,r){this.log('onCriteria',q,r);var s=q.topic,t=q.event,u=q.status;s=s||this.topic,this.observers[s]=this.observers[s]||{},this.observers[s][t]=this.observers[s][t]||{};var v=this.observers[s][t];return u?(v[u]=this.observers[s][t][u]||[],v[u]=v[u].concat(r)):(v.observers=v.observers||[],v.observers=v.observers.concat(r)),this}},{key:'onStatus',value:function(q,r,s){var t;return t='object'===('undefined'==typeof q?'undefined':h(q))?q:{event:q},t.status=r,this.onCriteria(t,s)}},{key:'onSuccess',value:function(q,r){return this.onStatus(q,'success',r)}},{key:'onFailure',value:function(q,r){return this.onStatus(q,'failure',r)}},{key:'on',value:function(q,r){if(this.log('on',q,r),'object'===('undefined'==typeof q?'undefined':h(q))){return this.onCriteria(q,r)}var t=this.observers[q]||[];return this.observers[q]=t.concat(r),this}},{key:'onAll',value:function(q,r){var s=this;return Array.isArray(q)?(q.map(function(t){return s.on(t,r)}),this):void this.handleError('onAll: first argument must be a list (Array) of events to observe',eventNames)}},{key:'publishCriteria',value:function(q,r){if(this.log('publishCriteria',q,r),'string'==typeof q){return this.publish(q,r)}var t=q.topic,u=q.event,v=q.status;this.observers=this.observers||{};var w=this.observers[t]||{};w=w[u]||{},this.publishTo(w.observers,r,q),this.publishTo(w[v],r,q)}},{key:'publishTo',value:function(q,r,s){return Array.isArray(q)?q.map(function(t){return t(r)}):this.log('no observers registered for',s),this}},{key:'publish',value:function(q,r){if(this.log('publish',q,r),'object'===('undefined'==typeof q?'undefined':h(q))){var s=this._criteria(q,r);this.publishCriteria(s,r)}this.observers=this.observers||{};var t=this.observers[q]||[];return t?t.map(function(u){return u(r)}):this.log('no observers registered for',q),this}},{key:'defaultTopic',get:function(){return'default'}}]),o}(l.Loggable)},function(a,b,c){'use strict';function f(r,s){if(!(r instanceof s))throw new TypeError('Cannot call a class as a function')}function g(r,s){if(!r)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return s&&('object'==typeof s||'function'==typeof s)?s:r}function h(r,s){if('function'!=typeof s&&null!==s)throw new TypeError('Super expression must either be null or a function, not '+typeof s);r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(r,s):r.__proto__=s)}function j(r){return'object'===('undefined'==typeof r?'undefined':m(r))&&null!==r}Object.defineProperty(b,'__esModule',{value:!0}),b.Store=void 0;var l=function(){function r(s,t){for(var v,u=0;u<t.length;u++)v=t[u],v.enumerable=v.enumerable||!1,v.configurable=!0,'value'in v&&(v.writable=!0),Object.defineProperty(s,v.key,v)}return function(s,t,u){return t&&r(s.prototype,t),u&&r(s,u),s}}(),m='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&'function'==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?'symbol':typeof r};b.createStore=function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new q(r,s)};var n=c(1),o=c(0),p=function(r){return r&&r.__esModule?r:{default:r}}(o),q=b.Store=function(r){function s(t){var u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};f(this,s);var v=g(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,'Store',u));return v.configured={},v.validated={},v.keyNames=t,v.opts=u,v.log('create',{keyNames:v.keyNames,opts:v.opts}),v.configure(),v.postConfigure(),v}return h(s,r),l(s,[{key:'configure',value:function(u){if(!this.configured.Store||u){this.configured.Store=!1;var v=this.keyNames||{},w=this.opts;try{this.keyNames=Object.assign({},this.defaultKeyNames,v.storage||v),this.configureKeyNames(),this.storage=w.store||w.keyStore||this.localStorage,this.configured.Store=!0}catch(x){this.handleError('Store.configure',{opts:w,keyNames:v,errMsg:x.message,cause:x})}}}},{key:'configureKeyNames',value:function(u){u=u||this.keyNames,j(u)||this.handleError('keyNames must be an Object',{keyNames:u,defaultKeyNames:this.defaultKeyNames}),this.authTokenKeyName=u.authTokenKeyName,this.gqlServerTokenKeyName=u.gqlServerTokenKeyName,this.serverTokenKeyName=u.serverTokenKeyName}},{key:'postConfigure',value:function(){this.validateConfig()}},{key:'validateConfig',value:function(){this.validated.Store=!1,this.log('validateConfig'),this.validateAllKeyNames(),this.validated.Store=!0}},{key:'validateAllKeyNames',value:function(){this.validateKeyName('authTokenKeyName'),this.validateKeyName('gqlServerTokenKeyName','warn'),this.validateKeyName('serverTokenKeyName','warn')}},{key:'validateKeyName',value:function(u,v){this[u]||this[v]('Store: key '+u+' not defined',{keyNames:this.keyNames,store:this})}},{key:'validateKeyNames',value:function(){for(var u=this,v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];w.map(function(y){return u.validateKeyName(y)})}},{key:'removeItem',value:function(u){return this.storage.removeItem(u),this.publish('remove',{name:u}),this}},{key:'getItem',value:function(u){return this.storage.getItem(u)}},{key:'setItem',value:function(u,v){return this.storage.setItem(u,v),this.publish('set',{name:u,value:v}),this}},{key:'resetAll',value:function(){return this.removeItem(this.authTokenKeyName),this.removeItem(this.gqlServerTokenKeyName),this.removeItem(this.serverTokenKeyName),this.publish('reset'),this}},{key:'getAll',value:function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return{authToken:this.getItem(this.authTokenKeyName),gqlServerToken:this.getItem(this.gqlServerTokenKeyName),serverToken:this.getItem(this.serverTokenKeyName)}}},{key:'store',value:function(u,v){2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(0>this.keyNames.indexOf(u))throw Error('keyname mismatch for store: '+u);this.setItem(u,v)}},{key:'defaultKeyNames',get:function(){return p.default}},{key:'localStorage',get:function(){try{return window.localStorage}catch(u){this.handleError('missing global window Object to retrieve localStorage')}}}]),s}(n.Notifiable)},function(a,b,c){'use strict';function d(p){return function(){var q=p.apply(this,arguments);return new Promise(function(r,s){function t(u,v){try{var w=q[u](v),x=w.value}catch(y){return void s(y)}return w.done?void r(x):Promise.resolve(x).then(function(y){t('next',y)},function(y){t('throw',y)})}return t('next')})}}function f(p,q){if(!(p instanceof q))throw new TypeError('Cannot call a class as a function')}function g(p,q){if(!p)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return q&&('object'==typeof q||'function'==typeof q)?q:p}function h(p,q){if('function'!=typeof q&&null!==q)throw new TypeError('Super expression must either be null or a function, not '+typeof q);p.prototype=Object.create(q&&q.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),q&&(Object.setPrototypeOf?Object.setPrototypeOf(p,q):p.__proto__=q)}Object.defineProperty(b,'__esModule',{value:!0}),b.GraphQLAuth=void 0;var k='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&'function'==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?'symbol':typeof p},l=function(){function p(q,r){for(var t,s=0;s<r.length;s++)t=r[s],t.enumerable=t.enumerable||!1,t.configurable=!0,'value'in t&&(t.writable=!0),Object.defineProperty(q,t.key,t)}return function(q,r,s){return r&&p(q.prototype,r),s&&p(q,s),q}}(),m=function p(q,r,s){null===q&&(q=Function.prototype);var t=Object.getOwnPropertyDescriptor(q,r);if(t===void 0){var u=Object.getPrototypeOf(q);return null===u?void 0:p(u,r,s)}if('value'in t)return t.value;var v=t.get;return void 0===v?void 0:v.call(s)};b.createGraphQLAuth=function(p,q){return new o(p,q)};var n=c(6),o=b.GraphQLAuth=function(p){function q(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};f(this,q);var t=g(this,(q.__proto__||Object.getPrototypeOf(q)).call(this,r,s));return t.name='GraphQLAuth',t.configure(),t.postConfig(),t}return h(q,p),l(q,[{key:'configure',value:function(s){if(!this.configured.GraphQLAuth||s){m(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),'configure',this).call(this);var t=this.config,u=this.opts,v=[t,u,u.client];return this.extractProperties(v,'createConnection','connection'),this.connection||this.createConnection||this.configError('Missing connection or createConnection option'),this.connection=this.connection||this.createConnection(t,u),this.configured.GraphQLAuth=!0,this}}},{key:'postConfig',value:function(){m(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),'postConfig',this).call(this),this.validateConfig()}},{key:'validateConfig',value:function(s){m(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),'validateConfig',this).call(this),this.validated.GraphQLAuth&&!s||(!this.connection&&this.configError('missing GraphQL connection in configuration'),this.validated.GraphQLAuth=!0)}},{key:'extractSignedInUserToken',value:function(s){return s.data.signinUser.token}},{key:'setGraphQLServerToken',value:function(s){return this.store||this.handleError('Missing store for setting signinToken',{signinToken:s}),this.store.setItem(this.gqlServerTokenKeyName,s),this.notifySuccess('token:stored',{signinToken:s}),this}},{key:'signin',value:function(){var s=d(regeneratorRuntime.mark(function t(u){var v,w,x,y,z;return regeneratorRuntime.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return v=u.authToken,w=u.profile,this.log('Signing into GraphQL server'),B.next=4,this.doCreateUser(u);case 4:return x=B.sent,B.next=7,this.doSigninUser(u);case 7:return y=B.sent,z=this.extractSignedInUserToken(y),this.handleReceivedGraphQLServerToken(z),B.abrupt('return',{status:y,token:z});case 11:case'end':return B.stop();}},t,this)}));return function(){return s.apply(this,arguments)}}()},{key:'handleReceivedGraphQLServerToken',value:function(s){this.notifySuccess('token:received',{signinToken:s}),this.setGraphQLServerToken(s),this.setJwtToken(s)}},{key:'setJwtToken',value:function(s){this.connection||this.error('missing connection for setting JWT token'),this.connection.setJwtToken(s,this.opts),this.notifySuccess('jwt:token',{signinToken:s})}},{key:'handleQueryError',value:function(s){s.graphQLErrors&&s.graphQLErrors[0].code===errorCode.USER_ALREADY_EXISTS||this.handleError(s)}},{key:'buildUserData',value:function(s){var t=s.authToken,u=s.profile;return{variables:{authToken:t,name:u.name}}}},{key:'doCreateUser',value:function(){var s=d(regeneratorRuntime.mark(function t(u){var v,w,x,y,z,A;return regeneratorRuntime.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=u.authToken,w=u.profile,x=void 0,y=void 0,C.prev=3,y=this.buildUserData(u),this.log('Create user',u),this.validateQueries(),!(this.queries&&this.queries.createUser)){C.next=16;break}return z=this.queries.createUser(y),C.next=11,this.doQuery(z);case 11:return A=C.sent,this.notifySuccess('user:create',{authToken:v,userData:y,profile:w,result:A}),C.abrupt('return',A);case 16:return this.log('missing createUser query, faking it'),C.next=19,this.fakeCreateUser(y);case 19:return C.abrupt('return',C.sent);case 20:C.next=26;break;case 22:C.prev=22,C.t0=C['catch'](3),this.notifyFailure('user:create',{authToken:v,userData:y,profile:w,result:x,error:C.t0}),this.handleQueryError(err);case 26:case'end':return C.stop();}},t,this,[[3,22]])}));return function(){return s.apply(this,arguments)}}()},{key:'validateQueries',value:function(){'object'!==k(this.queries)&&this.warn('No queries object defined',{queries:this.queries})}},{key:'doQuery',value:function(){var s=d(regeneratorRuntime.mark(function t(u){var v=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.connection.doQuery(u,v);case 2:return x.abrupt('return',x.sent);case 3:case'end':return x.stop();}},t,this)}));return function(){return s.apply(this,arguments)}}()},{key:'fakeCreateUser',value:function(s){return s}},{key:'buildSigninUserData',value:function(s){var t=s.authToken,u=s.profile;return{variables:{authToken:t}}}},{key:'doSigninUser',value:function(){var s=d(regeneratorRuntime.mark(function t(u){var v,w,x,y,z;return regeneratorRuntime.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(v=u.authToken,w=u.profile,this.log('signin user',u),this.validateQueries(),this.queries&&this.queries.signinUser){B.next=5;break}return B.abrupt('return',this.fakeSigninUser(w));case 5:return x=this.buildSigninUserData(u),B.prev=6,y=this.queries.signinUser(x),B.next=10,this.doQuery(y);case 10:return z=B.sent,this.notifySuccess('server:signin',{authToken:v,profile:w,userData:x,result:z}),B.abrupt('return',z);case 15:B.prev=15,B.t0=B['catch'](6),this.notifyFailure('server:signin',{authToken:v,profile:w,userData:x,error:B.t0}),this.handleQueryError(B.t0);case 19:case'end':return B.stop();}},t,this,[[6,15]])}));return function(){return s.apply(this,arguments)}}()},{key:'fakeSigninUser',value:function(){return this.log('returning fake signedinUser'),{data:{signinUser:{token:'1234'}}}}},{key:'gqlServerTokenKeyName',get:function(){return this.store.gqlServerTokenKeyName}}]),q}(n.GraphQLConnection)},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var d=c(3);Object.defineProperty(b,'GraphQLAuth',{enumerable:!0,get:function(){return d.GraphQLAuth}})},function(a,b,c){'use strict';(function(d){function f(q){return function(){var r=q.apply(this,arguments);return new Promise(function(s,t){function u(v,w){try{var x=r[v](w),y=x.value}catch(z){return void t(z)}return x.done?void s(y):Promise.resolve(y).then(function(z){u('next',z)},function(z){u('throw',z)})}return u('next')})}}function g(q,r){if(!(q instanceof r))throw new TypeError('Cannot call a class as a function')}function h(q,r){if(!q)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return r&&('object'==typeof r||'function'==typeof r)?r:q}function j(q,r){if('function'!=typeof r&&null!==r)throw new TypeError('Super expression must either be null or a function, not '+typeof r);q.prototype=Object.create(r&&r.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(q,r):q.__proto__=r)}Object.defineProperty(b,'__esModule',{value:!0}),b.GraphQLConnection=void 0;var l='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(q){return typeof q}:function(q){return q&&'function'==typeof Symbol&&q.constructor===Symbol&&q!==Symbol.prototype?'symbol':typeof q},m=function(){function q(r,s){for(var u,t=0;t<s.length;t++)u=s[t],u.enumerable=u.enumerable||!1,u.configurable=!0,'value'in u&&(u.writable=!0),Object.defineProperty(r,u.key,u)}return function(r,s,t){return s&&q(r.prototype,s),t&&q(r,t),r}}(),n=function q(r,s,t){null===r&&(r=Function.prototype);var u=Object.getOwnPropertyDescriptor(r,s);if(u===void 0){var v=Object.getPrototypeOf(r);return null===v?void 0:q(v,s,t)}if('value'in u)return u.value;var w=u.get;return void 0===w?void 0:w.call(t)};b.createConnection=function(q,r){return new p(q,r)};var o=c(8),p=b.GraphQLConnection=function(q){function r(){var s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};g(this,r);var u=h(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,t));return u.name='GraphQLConnection',u.configure(),u.postConfig(),u}return j(r,q),m(r,[{key:'configure',value:function(){if(n(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),'configure',this).call(this),!this.configured.GraphQLConnection){var t=this.config,u=t.gqlServer;return u||this.configError('missing gqlServer object in configuration'),this.log('gqlServer config',{gqlServer:u}),u.endpoint=d.env.gqlServer_endpoint||u.endpoint||u.connection.uri,this.config.gqlServer=u||{},this}}},{key:'prepareQuery',value:function(t){var u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.log('doQuery',{query:t,opts:u}),this.client||this.handleError('doQuery: missing client'),t||this.handleError('doQuery: query is not defined',t),this.isGqlQuery(t)&&(t=this.toGqlQuery(t)),t}},{key:'doQuery',value:function(){var t=f(regeneratorRuntime.mark(function u(v){var w=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:this.log('doQuery',{query:v,opts:w}),this.handleError('doQuery: must be implemented by subclass');case 2:case'end':return y.stop();}},u,this)}));return function(){return t.apply(this,arguments)}}()},{key:'isGqlQuery',value:function(t){return'object'===('undefined'==typeof t?'undefined':l(t))&&'Document'===t.kind}},{key:'toGqlQuery',value:function(t,u){return'string'!=typeof query&&this.handleError('toGqlQuery: bad query',t),'function'!=typeof this.gql&&(this.log('Try: https://www.npmjs.com/package/graphql-tag'),this.error('Also see: https://www.npmjs.com/package/graphql'),this.handleError('missing gql function to convert query string to GraphQL query')),this.gql(query,u)}},{key:'postConfig',value:function(){this.validateConfig(),this.configured.GraphQLConnection=!0}},{key:'validateConfig',value:function(t){this.validated.GraphQLConnection&&!t||(this.validated.GraphQLConnection=!1,n(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),'validateConfig',this).call(this,t),this.validated.GraphQLConnection=!0)}},{key:'setJwtToken',value:function(t){1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.log('setJwtToken not yet implemented on GraphQL server Connection :(',{signinToken:t})}},{key:'defaultHeaders',get:function(){return null}},{key:'authTokenKeyName',get:function(){return d.env.gqlServer_tokenKeyName||this.keyNames.gqlServerTokenKeyName}},{key:'authToken',get:function(){return this.store.getItem(this.authTokenKeyName)||null}}]),r}(o.Configurable)}).call(b,c(11))},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var d=c(5);Object.defineProperty(b,'GraphQLConnection',{enumerable:!0,get:function(){return d.GraphQLConnection}}),Object.defineProperty(b,'createConnection',{enumerable:!0,get:function(){return d.createConnection}})},function(a,b,c){'use strict';function f(r,s){if(!(r instanceof s))throw new TypeError('Cannot call a class as a function')}function g(r,s){if(!r)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return s&&('object'==typeof s||'function'==typeof s)?s:r}function h(r,s){if('function'!=typeof s&&null!==s)throw new TypeError('Super expression must either be null or a function, not '+typeof s);r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(r,s):r.__proto__=s)}Object.defineProperty(b,'__esModule',{value:!0}),b.Configurable=void 0;var j='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&'function'==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?'symbol':typeof r},k=function(){function r(s,t){for(var v,u=0;u<t.length;u++)v=t[u],v.enumerable=v.enumerable||!1,v.configurable=!0,'value'in v&&(v.writable=!0),Object.defineProperty(s,v.key,v)}return function(s,t,u){return t&&r(s.prototype,t),u&&r(s,u),s}}(),l=c(0),m=function(r){return r&&r.__esModule?r:{default:r}}(l),n=c(1),o=c(2),p=c(9),q=b.Configurable=function(r){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};f(this,s);var v=g(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,'Configurable',u));return v.configured={},v.validated={},v.validate(t),v.log('configuring with',{config:t,opts:u}),v.opts=v.opts||u,v.config=t,v.configure(),v.postConfig(),v}return h(s,r),k(s,[{key:'configure',value:function(){if(!this.configured.Configurable)return this.log('Configurable: configure'),this.observers={},this.configureStorage(),this.configured.Configurable=!0,this}},{key:'postConfig',value:function(){return this.validateConfig(),this.retrieveTokens(),this}},{key:'configureStorage',value:function(){this.log('configureStorage');var u=this.config,v=this.opts;return this.extractProperties([u,v],'storage','keyNames','store'),this.keyNames=this.keyNames||this.storage||m.default,this.store=this.store||this.createStore(this.keyNames,this.opts),this}},{key:'validateConfig',value:function(){var u=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.validated.Configurable&&!u||(this.log('validateConfig',{store:this.store,keyNames:this.keyNames}),'object'!==j(this.store)&&this.configError('missing store for holding auth tokens'),'object'!==j(this.keyNames)&&this.configError('missing keyNames object, used to indicate store token keys'),this.validated.Configurable=!0)}},{key:'retrieveTokens',value:function(){return this.log('retrieveTokens',{store:this.store}),(0,p.isFun)(this.store.getAll)||this.error('Store is missing function getAll to retrieve tokens'),this.tokens=this.store.getAll()||{},this}},{key:'extractProperty',value:function(u,v,w){this.log('extractProperty',v,{self:w}),(0,p.isArray)(u)||this.handleError('extractProperty: containes must be an Array',u);var x=u.find(function(A){return(A||{})[v]})||{},y=x[v];if(y||this.warn('no value found for',v),w&&y){var z=(0,p.isFun)(y)?y.name:y;this.log('extract: set',v,'to',z),this[v]=y}return y}},{key:'extractProps',value:function(u,v){for(var w=this,x=arguments.length,y=Array(2<x?x-2:0),z=2;z<x;z++)y[z-2]=arguments[z];return this.log('extractProperties',y),y.reduce(function(A,B){var C=w.extractProperty(v,B,u);return A[B]=C,A},{})}},{key:'extractProperties',value:function(u){for(var v=arguments.length,w=Array(1<v?v-1:0),x=1;x<v;x++)w[x-1]=arguments[x];return this.extractProps.apply(this,[!0,u].concat(w))}},{key:'configError',value:function(u){this.handleError(u)}},{key:'createStore',value:function(u){var v=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},w=v,t=w.createStore;return u=u||this.keyNames,v=v||this.opts,this.log('createStore',{keyNames:u,opts:v}),t=(0,p.isFun)(t)?t:this.defaultCreateStore,this.log('create with',{createStore:t}),t(u,v)}},{key:'defaultCreateStore',value:function(u,v){return(0,o.createStore)(u,v)}},{key:'validate',value:function(u){(0,p.isObject)(u)||this.handleError('config must be an object',u)}}]),s}(n.Notifiable)},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var d=c(7);Object.defineProperty(b,'Configurable',{enumerable:!0,get:function(){return d.Configurable}});var f=c(0);Object.defineProperty(b,'keyNames',{enumerable:!0,get:function(){return f.keyNames}});var g=c(2);Object.defineProperty(b,'Store',{enumerable:!0,get:function(){return g.Store}}),Object.defineProperty(b,'createStore',{enumerable:!0,get:function(){return g.createStore}})},function(a,b){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var h='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(j){return typeof j}:function(j){return j&&'function'==typeof Symbol&&j.constructor===Symbol&&j!==Symbol.prototype?'symbol':typeof j};b.isFun=function(j){return'function'==typeof j},b.isObject=function(j){return'object'===('undefined'==typeof j?'undefined':h(j))},b.isArray=function(j){return Array.isArray(j)}},function(a,b){'use strict';function d(h,j){if(!(h instanceof j))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var f=function(){function h(j,k){for(var m,l=0;l<k.length;l++)m=k[l],m.enumerable=m.enumerable||!1,m.configurable=!0,'value'in m&&(m.writable=!0),Object.defineProperty(j,m.key,m)}return function(j,k,l){return k&&h(j.prototype,k),l&&h(j,l),j}}(),g=b.Loggable=function(){function h(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};d(this,h),this.opts=k,this.io=k.io||console,this.logging=k.logging,this.name=j||k.name}return f(h,[{key:'handleError',value:function(k,l){throw this.error(k,l),this.notify&&this.notify('error',l),k}},{key:'enableLog',value:function(){return this.logging=!0,this}},{key:'disableLog',value:function(){return this.logging=!1,this}},{key:'label',value:function(k){return k=k.toUpperCase(),'['+this.name+'] '+k+':'}},{key:'warn',value:function(k,l){if(this.logging)return this.io.log(this.label('warning'),k,l)}},{key:'log',value:function(k,l){if(this.logging)return this.io.log(this.label('info'),k,l)}},{key:'error',value:function(k,l){if(this.logging)return this.io.error(this.label('error'),k,l)}}]),h}()},function(a){function c(){throw new Error('setTimeout has not been defined')}function d(){throw new Error('clearTimeout has not been defined')}function f(t){if(n===setTimeout)return setTimeout(t,0);if((n===c||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(u){try{return n.call(null,t,0)}catch(v){return n.call(this,t,0)}}}function g(t){if(o===clearTimeout)return clearTimeout(t);if((o===d||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{return o(t)}catch(u){try{return o.call(null,t)}catch(v){return o.call(this,t)}}}function h(){q&&r&&(q=!1,r.length?p=r.concat(p):s=-1,p.length&&j())}function j(){if(!q){var t=f(h);q=!0;for(var u=p.length;u;){for(r=p,p=[];++s<u;)r&&r[s].run();s=-1,u=p.length}r=null,q=!1,g(t)}}function k(t,u){this.fun=t,this.array=u}function l(){}var m=a.exports={},n,o;(function(){try{n='function'==typeof setTimeout?setTimeout:c}catch(t){n=c}try{o='function'==typeof clearTimeout?clearTimeout:d}catch(t){o=d}})();var p=[],q=!1,r,s=-1;m.nextTick=function(t){var u=Array(arguments.length-1);if(1<arguments.length)for(var v=1;v<arguments.length;v++)u[v-1]=arguments[v];p.push(new k(t,u)),1!==p.length||q||f(j)},k.prototype.run=function(){this.fun.apply(null,this.array)},m.title='browser',m.browser=!0,m.env={},m.argv=[],m.version='',m.versions={},m.on=l,m.addListener=l,m.once=l,m.off=l,m.removeListener=l,m.removeAllListeners=l,m.emit=l,m.prependListener=l,m.prependOnceListener=l,m.listeners=function(){return[]},m.binding=function(){throw new Error('process.binding is not supported')},m.cwd=function(){return'/'},m.chdir=function(){throw new Error('process.chdir is not supported')},m.umask=function(){return 0}}])});
//# sourceMappingURL=bundle.prod.js.map